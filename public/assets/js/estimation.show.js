(()=>{function t(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var o=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=o){var a,n,r,i,c=[],u=!0,l=!1;try{if(r=(o=o.call(t)).next,0===e){if(Object(o)!==o)return;u=!1}else for(;!(u=(a=r.call(o)).done)&&(c.push(a.value),c.length!==e);u=!0);}catch(t){l=!0,n=t}finally{try{if(!u&&null!=o.return&&(i=o.return(),Object(i)!==i))return}finally{if(l)throw n}}return c}}(t,e)||o(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e(t){return function(t){if(Array.isArray(t))return a(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||o(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(t,e){if(t){if("string"==typeof t)return a(t,e);var o={}.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?a(t,e):void 0}}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,a=Array(e);o<e;o++)a[o]=t[o];return a}document.addEventListener("alpine:init",(function(){Alpine.data("estimationShow",(function(){return{items:{},comments:{},newItems:{},groups:{},totals:{},expandedRows:{},lastGroupNumber:0,lastItemNumbers:{},searchQuery:"",selectAll:!1,isFullScreen:!1,autoSaveEnabled:!0,contextMenu:{show:!1,x:0,y:0,selectedRowId:null},columnVisibility:{column_pos:!0,column_name:!0,column_quantity:!0,column_unit:!0,column_optional:!0,quote_th:!0},init:function(){var t=this;this.initializeData(),this.initializeSortable(),this.initializeLastNumbers(),this.initializeContextMenu(),this.initializeColumnVisibility(),this.initializeCardCalculations(),this.$watch("items",(function(o){t.calculateTotals(),e(new Set(Array.from(document.querySelectorAll("[data-cardquoteid]")).map((function(t){return t.dataset.cardquoteid})))).forEach((function(e){return t.calculateCardTotals(e)}))}),{deep:!0}),this.$watch("autoSaveEnabled",(function(e){e&&t.saveTableData()})),this.$watch("searchQuery",(function(){return t.filterTable()})),this.$watch("selectAll",(function(e){return t.checkboxAll(e)})),document.addEventListener("click",(function(e){e.target.closest(".context-menu")||(t.showContextMenu=!1)})),document.addEventListener("fullscreenchange",(function(){t.isFullScreen=!!document.fullscreenElement;var e=document.querySelector(".fa-expand, .fa-compress");e&&(e.className=t.isFullScreen?"fa-solid fa-compress":"fa-solid fa-expand")})),document.addEventListener("keydown",(function(e){(e.target.classList.contains("item-quantity")||e.target.classList.contains("item-price"))&&t.handleInputBlur(e)}))},initializeFullScreen:function(){var t=this;document.addEventListener("fullscreenchange",(function(){t.isFullScreen=!!document.fullscreenElement;var e=document.querySelector(".tools-btn button i.fa-expand, .tools-btn button i.fa-compress");e&&(e.className=t.isFullScreen?"fa-solid fa-compress":"fa-solid fa-expand")}))},toggleFullScreen:function(){var t=document.querySelector(".estimation-show");t&&(document.fullscreenElement?document.exitFullscreen():t.requestFullscreen().catch((function(t){console.error("Error attempting to enable fullscreen: ".concat(t.message))})))},initializeData:function(){var t=this;this.items={},this.comments={},this.groups={},this.lastGroupNumber=0,this.lastItemNumbers={},document.querySelectorAll("tr.group_row").forEach((function(e){var o=e.dataset.groupid,a=e.querySelector(".grouppos").textContent.trim(),n=parseInt(a);t.groups[o]={id:o,pos:a,name:e.querySelector(".grouptitle-input").value,total:t.parseNumber(e.querySelector(".text-right").textContent),itemCount:0},t.lastGroupNumber=Math.max(t.lastGroupNumber,n)})),document.querySelectorAll("tr.item_row").forEach((function(e){var o=e.dataset.itemid,a=e.dataset.groupid;t.items[o]={id:o,type:"item",groupId:a,pos:e.querySelector(".pos-inner").textContent.trim(),name:e.querySelector(".item-name").value,quantity:t.parseNumber(e.querySelector(".item-quantity").value),prices:t.updateItemPriceAndTotal(o),optional:e.querySelector(".item-optional").checked,unit:e.querySelector(".item-unit").value},t.groups[a].itemCount++})),document.querySelectorAll("tr.item_comment").forEach((function(e){var o=e.dataset.commentid,a=e.dataset.groupid;t.comments[o]={id:o,type:"comment",groupId:a,pos:e.querySelector(".pos-inner").textContent.trim(),content:e.querySelector(".column_name input").value,expanded:!1},t.groups[a].itemCount++})),this.updatePOSNumbers(),this.calculateTotals()},calculateItemTotal:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=this.items[t];if(!o||o.optional)return 0;var a=o.prices[e],n=(a.singlePrice,a.totalPrice),r=document.querySelector('tr[data-itemid="'.concat(t,'"] .column_total_price[data-cardquoteid="').concat(e,'"]'));return r&&(r.textContent=this.formatCurrency(n),this.setNegativeStyle(r,n)),n},calculateTotals:function(){var t=this;this.totals={},document.querySelectorAll("tr.group_row").forEach((function(e){var o,a=e.dataset.groupid;a&&(t.calculateGroupTotal(a),t.groups[a]&&(t.groups[a].total=t.parseNumber((null===(o=e.querySelector(".text-right.grouptotal"))||void 0===o?void 0:o.textContent)||"0")))}))},calculateGroupTotal:function(t){var e=this,o={},a=document.querySelector('tr.group_row[data-groupid="'.concat(t,'"]'));if(!a)return 0;for(var n=a.nextElementSibling,r=function(){if(n.classList.contains("item_row")){var t;n.dataset.itemid;if(null!==(t=n.querySelector(".item-optional"))&&void 0!==t&&t.checked)n.querySelectorAll(".column_total_price").forEach((function(t){t.textContent="-",t.style.backgroundColor="",t.style.color=""}));else{var a,r=e.parseNumber((null===(a=n.querySelector(".item-quantity"))||void 0===a?void 0:a.value)||"0");n.querySelectorAll(".item-price").forEach((function(t,a){o[a]||(o[a]=0);var i=e.parseNumber(t.value||"0");o[a]+=r*i;var c=n.querySelectorAll(".column_total_price")[a];if(c){var u=r*i;c.textContent=e.formatCurrency(u),e.setNegativeStyle(c,u)}}))}}n=n.nextElementSibling};n&&!n.classList.contains("group_row");)r();return a.querySelectorAll(".text-right.grouptotal").forEach((function(t,a){t.textContent=e.formatCurrency(o[a]||0),e.setNegativeStyle(t,o[a]||0);var n=t.dataset.cardquoteid;n&&e.calculateCardTotals(n)})),o[0]||0},calculateCardTotals:function(t){var e=this,o=0;document.querySelectorAll('td[data-cardquoteid="'.concat(t,'"].grouptotal')).forEach((function(t){o+=e.parseNumber(t.textContent)}));var a=document.querySelector('input[name="markup"][value]:not([value=""])[data-cardquoteid="'.concat(t,'"]')),n=this.parseNumber((null==a?void 0:a.value)||"0"),r=document.querySelector('input[name="discount"][data-cardquoteid="'.concat(t,'"]')),i=this.parseNumber((null==r?void 0:r.value)||"0"),c=document.querySelector('select[name="tax[]"][data-cardquoteid="'.concat(t,'"]')),u=c?this.parseNumber(c.value)/100:0,l=o+n,s=l-l*i/100,d=s+s*u;this.updateCardTotalUI(t,{netAmount:l,netWithDiscount:s,grossWithDiscount:d,subtotal:o})},updateCardTotalUI:function(t,e){var o=document.querySelector('th[data-cardquoteid="'.concat(t,'"].total-net-discount'));o&&(o.textContent=this.formatCurrency(e.netWithDiscount));var a=document.querySelector('th[data-cardquoteid="'.concat(t,'"].total-gross-discount'));a&&(a.textContent=this.formatCurrency(e.grossWithDiscount));var n=document.querySelector('th[data-cardquoteid="'.concat(t,'"].total-net'));n&&(n.textContent=this.formatCurrency(e.netAmount));var r=document.querySelector('th[data-cardquoteid="'.concat(t,'"] .total-gross-total'));r&&(r.textContent=this.formatCurrency(e.grossWithDiscount))},initializeCardCalculations:function(){var t=this;e(new Set(Array.from(document.querySelectorAll("[data-cardquoteid]")).map((function(t){return t.dataset.cardquoteid})))).forEach((function(e){t.calculateCardTotals(e);var o=document.querySelector('input[name="markup"][data-cardquoteid="'.concat(e,'"]'));if(o){var a=t.parseNumber(o.value);o.value=t.formatDecimal(a),t.setNegativeStyle(o,a)}})),document.addEventListener("change",(function(e){var o,a=e.target,n=null===(o=a.closest("[data-cardquoteid]"))||void 0===o?void 0:o.dataset.cardquoteid;if(n){if(a.matches('input[name="markup"]')){var r=t.parseNumber(a.value||"0");a.value=t.formatDecimal(r),t.setMarkupStyle(a,r),document.querySelectorAll('[data-cardquoteid="'.concat(n,'"] .item-price')).forEach((function(e){var o=e.dataset.originalPrice?t.parseNumber(e.dataset.originalPrice):t.parseNumber(e.value);e.dataset.originalPrice||(e.dataset.originalPrice=o);var a=t.parseNumber(e.dataset.originalPrice)+r;e.value=t.formatCurrency(a);var n=e.closest("tr");if(n){var i=n.dataset.itemid;i&&t.calculateItemTotal(i)}})),t.calculateGroupTotal(t.lastGroupId),t.calculateTotals()}(a.matches('input[name="markup"]')||a.matches('input[name="discount"]')||a.matches('select[name="tax[]"]')||a.matches(".item-price")||a.matches(".item-quantity")||a.matches(".item-optional"))&&t.calculateCardTotals(n)}}))},setMarkupStyle:function(t,e){e<0?(t.style.backgroundColor="rgb(255 240 240)",t.style.color="rgb(255 6 6)"):(t.style.backgroundColor="",t.style.color="")},setNegativeStyle:function(t,e){e<0?(t.style.backgroundColor="rgb(255 240 240)",t.style.color="rgb(255 6 6)"):(t.style.backgroundColor="",t.style.color="")},formatDecimal:function(t){return new Intl.NumberFormat("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2}).format(t)},formatCurrency:function(t){return new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR"}).format(t)},parseNumber:function(t){return"number"==typeof t?t:parseFloat(t.replace(/[^\d,-]/g,"").replace(",","."))||0},handleInputBlur:function(t,e){if("keydown"===t.type){if("Enter"!==t.key)return;t.target.blur()}var o=t.target.value,a=t.target.closest("tr").dataset.itemid;switch(e){case"item":this.items[a]&&(this.items[a].name=o);break;case"quantity":this.items[a]&&(this.items[a].quantity=this.parseNumber(o),this.updateItemPriceAndTotal(a)),this.formatDecimalValue(t.target);break;case"price":this.items[a]&&this.updateItemPriceAndTotal(a),this.formatCurrencyValue(t.target);break;case"unit":this.items[a]&&(this.items[a].unit=o)}this.calculateTotals()},updateItemPriceAndTotal:function(t){var e=this,o=document.querySelector('.item_row[data-itemid="'.concat(t,'"]')),a=o.querySelectorAll(".item-price"),n=Array.from(a).map((function(t){var a=t.closest("td[data-cardquoteid]").dataset.cardquoteid,n=e.parseNumber(t.value);return{id:a,singlePrice:n,totalPrice:n*e.parseNumber(o.querySelector(".item-quantity").value)}}));return this.items[t]&&(this.items[t].prices=n),n},formatDecimalValue:function(t){t.value=this.formatDecimal(this.parseNumber(t.value))},formatCurrencyValue:function(t){t.value=this.formatCurrency(this.parseNumber(t.value))},handleOptionalChange:function(t,e){this.items[e]&&(this.items[e].optional=t.target.checked,this.newItems[e]&&(this.newItems[e].optional=t.target.checked),this.calculateTotals())},filterTable:function(){var e=this.searchQuery.toLowerCase();Object.entries(this.items).forEach((function(o){var a=t(o,2),n=a[0],r=a[1],i=document.querySelector('tr[data-itemid="'.concat(n,'"]'));i&&(i.style.display=r.name.toLowerCase().includes(e)||r.pos.toLowerCase().includes(e)?"":"none")})),Object.entries(this.groups).forEach((function(o){var a=t(o,2),n=a[0],r=a[1],i=document.querySelector('tr[data-groupid="'.concat(n,'"]'));i&&(i.style.display=r.name.toLowerCase().includes(e)||r.pos.toLowerCase().includes(e)?"":"none")})),document.querySelectorAll("tr.item_comment").forEach((function(t){var o=t.querySelector(".item-description"),a=t.querySelector(".pos-inner");if(o&&a){var n=o.value.toLowerCase(),r=a.textContent.toLowerCase();t.style.display=n.includes(e)||r.includes(e)?"":"none"}}))},initializeSortable:function(){var t=this;$("#estimation-edit-table").sortable({items:"tbody tr",cursor:"pointer",axis:"y",dropOnEmpty:!0,handle:".fa-bars, .fa-up-down",animation:150,start:function(t,e){e.item.addClass("selected")},stop:function(e,o){var a=o.item[0];if(a.classList.contains("item_row")||a.classList.contains("item_comment")){for(var n=a.previousElementSibling,r=null;n&&!r;)n.classList.contains("group_row")&&(r=n),n=n.previousElementSibling;if(r){var i=r.dataset.groupid,c=a.dataset.itemid||a.dataset.id;a.dataset.groupid;a.dataset.groupid=i,t.items[c]&&(t.items[c].groupId=i),t.newItems[c]&&(t.newItems[c].groupId=i)}}t.updatePOSNumbers(),t.calculateTotals()}})},initializeLastNumbers:function(){var e=this,o=new Set;document.querySelectorAll(".pos-inner").forEach((function(a){var n=a.textContent.trim();if(n){o.add(n);var r=t(n.split("."),2),i=r[0],c=r[1],u=parseInt(i),l=parseInt(c);e.lastGroupNumber=Math.max(e.lastGroupNumber,u),(!e.lastItemNumbers[u]||l>e.lastItemNumbers[u])&&(e.lastItemNumbers[u]=Math.min(l,99))}})),document.querySelectorAll(".grouppos").forEach((function(t){var o=parseInt(t.textContent.trim());e.lastGroupNumber=Math.max(e.lastGroupNumber,o)}))},addItem:function(t){var e,o=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=Date.now();if(!(document.querySelectorAll("tr.group_row").length>0)){var r=Date.now();e="group_".concat(r);var i={id:r,type:"group",name:"New Group",total:0,expanded:!1,pos:""};this.items[r]=i,this.newItems[r]=i,this.groups[e]={id:e,pos:"",name:"New Group",total:0,itemCount:0};var c=Date.now()+1,u={id:c,type:"item",groupId:e,name:"New Item",quantity:0,price:0,unit:"",optional:!1,expanded:!1,pos:""};return this.items[c]=u,this.newItems[c]=u,void this.$nextTick((function(){o.initializeSortable(),o.updatePOSNumbers(),o.calculateTotals()}))}if("group"===t){e="group_".concat(n);var l={id:n,type:"group",name:"Group name",total:0,expanded:!1,pos:""};return this.items[n]=l,this.newItems[n]=l,this.groups[e]={id:e,pos:"",name:"Group name",total:0,itemCount:0},void this.$nextTick((function(){o.initializeSortable(),o.updatePOSNumbers(),o.calculateTotals()}))}if(a){var s=document.querySelector('tr[data-id="'.concat(a,'"], \n                                               tr[data-itemid="').concat(a,'"], \n                                               tr[data-commentid="').concat(a,'"], \n                                               tr[data-groupid="').concat(a,'"]'));s&&(s.classList.contains("group_row"),e=s.dataset.groupid)}else{var d=document.querySelectorAll("tr.group_row"),m=d[d.length-1];e=m?m.dataset.groupid:null}var p={id:n,type:t,groupId:e,name:t+" name",quantity:0,price:0,unit:"",optional:!1,expanded:!1,pos:""};this.items[n]=p,this.newItems[n]=p,this.$nextTick((function(){if(a){var t=document.querySelector('tr[data-id="'.concat(a,'"], \n                                                   tr[data-itemid="').concat(a,'"], \n                                                   tr[data-commentid="').concat(a,'"], \n                                                   tr[data-groupid="').concat(a,'"]')),e=document.querySelector('tr[data-id="'.concat(n,'"], \n                                                tr[data-itemid="').concat(n,'"]'));e&&t.nextSibling&&t.parentNode.insertBefore(e,t.nextSibling)}o.initializeSortable(),o.updatePOSNumbers(),o.calculateTotals()})),a&&(this.contextMenu.show=!1)},removeItem:function(){var t=this,e=document.querySelectorAll(".item_selection:checked");0!==e.length?Swal.fire({title:"Confirmation Delete",text:"Really! You want to remove them? You can't undo",showCancelButton:!0,confirmButtonText:"Yes, Delete it",cancelButtonText:"No, cancel"}).then((function(o){if(o.isConfirmed){var a=[],n=[];e.forEach((function(e){var o=e.closest("tr");o.classList.contains("group_row")?(n.push(o.dataset.groupid),delete t.groups[o.dataset.groupid]):(a.push(o.dataset.itemid),delete t.items[o.dataset.itemid]),o.remove()})),document.querySelector(".SelectAllCheckbox").checked=!1,fetch(route("estimations.remove_items.estimate"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content},body:JSON.stringify({estimation_id:window.estimation_id,item_ids:a,group_ids:n})}),t.calculateTotals(),t.updatePOSNumbers()}})):toastrs("Error","Please select checkbox to continue delete")},updatePOSNumbers:function(){var t=this,e=0,o=0,a=null;document.querySelectorAll("tr").forEach((function(n){if(n.classList.contains("group_row")){e++,o=0,a=n.dataset.groupid;var r=e.toString().padStart(2,"0");n.querySelector(".grouppos").textContent="".concat(r),t.groups[a]&&(t.groups[a].pos=r)}else if(n.classList.contains("item_row")||n.classList.contains("item_comment")){o++;var i="".concat(e.toString().padStart(2,"0"),".").concat(o.toString().padStart(2,"0"));n.querySelector(".pos-inner").textContent=i;var c=n.dataset.itemid||n.dataset.commentid;t.items[c]&&(t.items[c].pos=i)}}))},duplicateCardColumn:function(t){alert("Action for duplicateCardColumn"+t)},deleteCardColumn:function(t){var e=this;Swal.fire({title:"Confirmation Delete",text:"Really! You want to remove this column? You can't undo",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, Delete it",cancelButtonText:"No, cancel",customClass:{confirmButton:"btn btn-danger",cancelButton:"btn btn-secondary"}}).then((function(o){if(o.isConfirmed)try{document.querySelectorAll('[data-cardquoteid="'.concat(t,'"]')).forEach((function(t){return t.remove()})),e.calculateTotals(),Swal.fire({title:"Deleted!",text:"The Column has been deleted successfully",icon:"success",timer:1500,showConfirmButton:!1})}catch(t){console.error("Error deleting column:",t),Swal.fire({title:"Error!",text:"An error occurred while deleting the column",icon:"error",confirmButtonText:"OK"})}}))},toggleDescription:function(t,e){e.stopPropagation(),this.expandedRows||(this.expandedRows={}),this.expandedRows[t]=!this.expandedRows[t];var o=e.target.closest("tr"),a=document.querySelector('tr.item_child[data-id="'.concat(t,'"]'));if(a){a.style.display=this.expandedRows[t]?"table-row":"none";var n=o.querySelector(".desc_toggle");n&&(n.classList.toggle("fa-caret-right"),n.classList.toggle("fa-caret-down"))}},isExpanded:function(t){return this.expandedRows[t]||!1},initializeContextMenu:function(){var t=this;document.querySelector("#estimation-edit-table").addEventListener("contextmenu",(function(e){var o=e.target.closest("tr.item_row, tr.group_row, tr.item_comment");if(o){e.preventDefault();var a=window.innerWidth,n=window.innerHeight,r=e.clientX,i=e.clientY;r+160>a&&(r=a-160),i+160>n&&(i=n-160),t.contextMenu={show:!0,x:r,y:i,selectedRowId:o.dataset.id||o.dataset.itemid||o.dataset.commentid||o.dataset.groupid}}}))},moveRow:function(t,e){var o=document.querySelector('tr[data-id="'.concat(e,'"], \n                                         tr[data-itemid="').concat(e,'"], \n                                         tr[data-commentid="').concat(e,'"], \n                                         tr[data-groupid="').concat(e,'"]'));if(o){if("up"===t){var a=o.previousElementSibling;a&&o.parentNode.insertBefore(o,a)}else{var n=o.nextElementSibling;n&&o.parentNode.insertBefore(n,o)}this.updatePOSNumbers(),this.calculateTotals(),this.contextMenu.show=!1}},duplicateRow:function(t){var e=this,o=document.querySelector('tr[data-id="'.concat(t,'"], \n                                                 tr[data-itemid="').concat(t,'"], \n                                                 tr[data-commentid="').concat(t,'"], \n                                                 tr[data-groupid="').concat(t,'"]'));if(o){var a=Date.now(),n=o.classList.contains("group_row"),r=o.classList.contains("item_comment"),i=n?null:o.dataset.groupid;if(n){var c=o.querySelector(".grouptitle-input").value,u="group_".concat(a),l={id:a,type:"group",name:"".concat(c," - copy"),total:0,expanded:!1};this.items[a]=l,this.newItems[a]=l,this.groups[u]={id:u,pos:"",name:"".concat(c," - copy"),total:0,itemCount:0}}else if(r){var s={id:a,type:"comment",groupId:i,content:o.querySelector(".item-description").value,expanded:!1};this.items[a]=s,this.newItems[a]=s}else{var d,m,p,f,h,y={id:a,type:o.classList.contains("item_comment")?"comment":"item",groupId:i,name:(null===(d=o.querySelector(".item-name"))||void 0===d?void 0:d.value)+" - copy",quantity:this.parseNumber((null===(m=o.querySelector(".item-quantity"))||void 0===m?void 0:m.value)||"0"),unit:(null===(p=o.querySelector(".item-unit"))||void 0===p?void 0:p.value)||"",optional:(null===(f=o.querySelector(".item-optional"))||void 0===f?void 0:f.checked)||!1,price:this.parseNumber((null===(h=o.querySelector(".item-price"))||void 0===h?void 0:h.value)||"0"),expanded:!1};this.items[a]=y,this.newItems[a]=y,this.groups[i]&&this.groups[i].itemCount++}this.$nextTick((function(){var t=document.querySelector('tr[data-id="'.concat(a,'"], tr[data-itemid="').concat(a,'"], tr[data-commentid="').concat(a,'"]'));t&&o.nextSibling&&o.parentNode.insertBefore(t,o.nextSibling),e.updatePOSNumbers(),e.calculateTotals(),e.initializeContextMenu()})),this.contextMenu.show=!1}},removeRowFromMenu:function(t){var e=this;Swal.fire({title:"Confirmation Delete",text:"Really! You want to remove this item? You can't undo",showCancelButton:!0,confirmButtonText:"Yes, Delete it",cancelButtonText:"No, cancel"}).then((function(o){if(o.isConfirmed){var a=document.querySelector('tr[data-id="'.concat(t,'"], tr[data-itemid="').concat(t,'"], tr[data-groupid="').concat(t,'"]'));if(!a)return;if(a.classList.contains("group_row")){var n=a.dataset.groupid;document.querySelectorAll('tr[data-groupid="'.concat(n,'"]')).forEach((function(t){var o=t.dataset.itemid;delete e.items[o],delete e.newItems[o],t.remove()})),delete e.groups[n]}else{var r=a.dataset.itemid||a.dataset.id;delete e.items[r],delete e.newItems[r]}a.remove(),e.updatePOSNumbers(),e.calculateTotals(),document.querySelector(".SelectAllCheckbox").checked=!1}})),this.contextMenu.show=!1},handleGroupSelection:function(t,e){var o=t.target.checked,a=t.target.closest("tr.group_row");if(a)for(var n=a.nextElementSibling;n&&!n.classList.contains("group_row");){var r=n.querySelector(".item_selection");r&&(r.checked=o),n=n.nextElementSibling}},checkboxAll:function(t){document.querySelectorAll(".item_selection").forEach((function(e){e.checked=t}))},initializeColumnVisibility:function(){var t=this;document.querySelectorAll(".column-toggle").forEach((function(e){e.addEventListener("change",(function(e){var o=e.target.dataset.column,a=e.target.dataset.quoteid;"quote_th"===o&&a?(t.columnVisibility[o]=e.target.checked,t.applyColumnVisibility(a)):(t.columnVisibility[o]=e.target.checked,t.applyColumnVisibility())}))}))},applyColumnVisibility:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;Object.entries(this.columnVisibility).forEach((function(o){var a=t(o,2),n=a[0],r=a[1];if("quote_th"===n&&e){var i=document.querySelectorAll(".quote_th".concat(e,", ")+'[data-cardquoteid="'.concat(e,'"]'));console.log(i),i.forEach((function(t){t.style.display=r?"":"none"}))}else{document.querySelectorAll(".".concat(n)).forEach((function(t){t.closest("td, th")&&(t.closest("td, th").style.display=r?"":"none")}))}}))},toggleColumn:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.columnVisibility[t]=!this.columnVisibility[t],this.applyColumnVisibility(e);var o=e?'.column-toggle[data-column="'.concat(t,'"][data-quote="').concat(e,'"]'):'.column-toggle[data-column="'.concat(t,'"]'),a=document.querySelector(o);a&&(a.checked=this.columnVisibility[t])},saveTableData:function(){var t={form:this.getFomrData(),item:this.serializeEstimationData(),group:this.groups};console.log(t),$.ajax({url:route("estimation.update",11),method:"PUT",data:t,beforeSend:function(){},success:function(t){console.log(t)}})},getFomrData:function(){var t=new FormData(this.$el.closest("form"));return Object.fromEntries(t)},serializeEstimationData:function(){return Object.values(this.items)}}}))}))})();