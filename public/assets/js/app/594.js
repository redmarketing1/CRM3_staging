(self.webpackChunk=self.webpackChunk||[]).push([[50,594],{594:()=>{function t(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var o=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=o){var n,i,a,r,c=[],u=!0,l=!1;try{if(a=(o=o.call(t)).next,0===e){if(Object(o)!==o)return;u=!1}else for(;!(u=(n=a.call(o)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){l=!0,i=t}finally{try{if(!u&&null!=o.return&&(r=o.return(),Object(r)!==r))return}finally{if(l)throw i}}return c}}(t,e)||o(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e(t){return function(t){if(Array.isArray(t))return n(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||o(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(t,e){if(t){if("string"==typeof t)return n(t,e);var o={}.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?n(t,e):void 0}}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,n=Array(e);o<e;o++)n[o]=t[o];return n}Alpine.data("estimationShow",(function(){return{items:{},newItems:{},groups:{},totals:{},expandedRows:{},lastGroupNumber:0,lastItemNumbers:{},searchQuery:"",selectAll:!1,isFullScreen:!1,contextMenu:{show:!1,x:0,y:0,selectedRowId:null},columnVisibility:{column_pos:!0,column_name:!0,column_quantity:!0,column_unit:!0,column_optional:!0,quote_th:!0},init:function(){var t=this;this.initializeData(),this.initializeSortable(),this.initializeLastNumbers(),this.initializeContextMenu(),this.initializeColumnVisibility(),this.initializeCardCalculations(),this.$watch("items",(function(){t.calculateTotals(),e(new Set(Array.from(document.querySelectorAll("[data-cardquoteid]")).map((function(t){return t.dataset.cardquoteid})))).forEach((function(e){return t.calculateCardTotals(e)}))}),{deep:!0}),this.$watch("searchQuery",(function(){return t.filterTable()})),this.$watch("selectAll",(function(e){return t.checkboxAll(e)})),document.addEventListener("click",(function(e){e.target.closest(".context-menu")||(t.showContextMenu=!1)})),document.addEventListener("fullscreenchange",(function(){t.isFullScreen=!!document.fullscreenElement;var e=document.querySelector(".fa-expand, .fa-compress");e&&(e.className=t.isFullScreen?"fa-solid fa-compress":"fa-solid fa-expand")})),document.addEventListener("keydown",(function(e){(e.target.classList.contains("item-quantity")||e.target.classList.contains("item-price"))&&t.handleInputBlur(e)}))},initializeFullScreen:function(){var t=this;document.addEventListener("fullscreenchange",(function(){t.isFullScreen=!!document.fullscreenElement;var e=document.querySelector(".tools-btn button i.fa-expand, .tools-btn button i.fa-compress");e&&(e.className=t.isFullScreen?"fa-solid fa-compress":"fa-solid fa-expand")}))},toggleFullScreen:function(){var t=document.querySelector(".estimation-show");t&&(document.fullscreenElement?document.exitFullscreen():t.requestFullscreen().catch((function(t){console.error("Error attempting to enable fullscreen: ".concat(t.message))})))},initializeData:function(){var t=this;this.items={},this.groups={},this.lastGroupNumber=0,this.lastItemNumbers={},document.querySelectorAll("tr.group_row").forEach((function(e){var o=e.dataset.groupid,n=e.querySelector(".grouppos").textContent.trim(),i=parseInt(n);t.groups[o]={id:o,pos:n,name:e.querySelector(".grouptitle-input").value,total:t.parseNumber(e.querySelector(".text-right").textContent),itemCount:0},t.lastGroupNumber=Math.max(t.lastGroupNumber,i)})),document.querySelectorAll("tr.item_row, tr.item_comment").forEach((function(e){var o=e.classList.contains("item_comment"),n=o?e.dataset.commentid:e.dataset.itemid,i=e.closest("tbody").querySelector("tr.group_row").dataset.groupid;t.items[n]=o?{id:n,type:"comment",groupId:i,pos:e.querySelector(".pos-inner").textContent.trim(),content:e.querySelector(".column_name input").value,expanded:!1}:{id:n,type:"item",groupId:i,pos:e.querySelector(".pos-inner").textContent.trim(),name:e.querySelector(".item-name").value,quantity:t.parseNumber(e.querySelector(".item-quantity").value),price:t.parseNumber(e.querySelector(".item-price").value),optional:e.querySelector(".item-optional").checked,unit:e.querySelector(".item-unit").value},t.groups[i].itemCount++})),this.updatePOSNumbers(),this.calculateTotals()},calculateItemTotal:function(t){var e,o,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=this.items[t]||this.newItems[t];if(!i||i.optional)return 0;var a=document.querySelector('tr[data-itemid="'.concat(t,'"]'));if(!a)return 0;var r=this.parseNumber((null===(e=a.querySelector(".item-quantity"))||void 0===e?void 0:e.value)||"0"),c=a.querySelectorAll(".item-price");return r*this.parseNumber((null===(o=c[n])||void 0===o?void 0:o.value)||"0")},calculateTotals:function(){var t=this;this.totals={},document.querySelectorAll("tr.group_row").forEach((function(e){var o,n=e.dataset.groupid;n&&(t.calculateGroupTotal(n),t.groups[n]&&(t.groups[n].total=t.parseNumber((null===(o=e.querySelector(".text-right.grouptotal"))||void 0===o?void 0:o.textContent)||"0")))}))},calculateGroupTotal:function(t){var e=this,o={},n=document.querySelector('tr.group_row[data-groupid="'.concat(t,'"]'));if(!n)return 0;for(var i=n.nextElementSibling,a=function(){if(i.classList.contains("item_row")){var t;i.dataset.itemid;if(null!==(t=i.querySelector(".item-optional"))&&void 0!==t&&t.checked)i.querySelectorAll(".column_total_price").forEach((function(t){t.textContent="-"}));else{var n,a=e.parseNumber((null===(n=i.querySelector(".item-quantity"))||void 0===n?void 0:n.value)||"0");i.querySelectorAll(".item-price").forEach((function(t,n){o[n]||(o[n]=0);var r=e.parseNumber(t.value||"0");o[n]+=a*r;var c=i.querySelectorAll(".column_total_price")[n];c&&(c.textContent=e.formatCurrency(a*r))}))}}i=i.nextElementSibling};i&&!i.classList.contains("group_row");)a();return n.querySelectorAll(".text-right.grouptotal").forEach((function(t,n){t.textContent=e.formatCurrency(o[n]||0);var i=t.dataset.cardquoteid;i&&e.calculateCardTotals(i)})),o[0]||0},calculateCardTotals:function(t){var e=this,o=0;document.querySelectorAll('td[data-cardquoteid="'.concat(t,'"].grouptotal')).forEach((function(t){o+=e.parseNumber(t.textContent)}));var n=document.querySelector('input[name="markup"][value]:not([value=""])[data-cardquoteid="'.concat(t,'"]')),i=this.parseNumber((null==n?void 0:n.value)||"0"),a=document.querySelector('input[name="discount"][data-cardquoteid="'.concat(t,'"]')),r=this.parseNumber((null==a?void 0:a.value)||"0"),c=document.querySelector('select[name="tax[]"][data-cardquoteid="'.concat(t,'"]')),u=c?this.parseNumber(c.value)/100:0,l=o+i,s=l-l*r/100,d=s+s*u;this.updateCardTotalUI(t,{netAmount:l,netWithDiscount:s,grossWithDiscount:d,subtotal:o})},updateCardTotalUI:function(t,e){var o=document.querySelector('th[data-cardquoteid="'.concat(t,'"].total-net-discount'));o&&(o.textContent=this.formatCurrency(e.netWithDiscount));var n=document.querySelector('th[data-cardquoteid="'.concat(t,'"].total-gross-discount'));n&&(n.textContent=this.formatCurrency(e.grossWithDiscount));var i=document.querySelector('th[data-cardquoteid="'.concat(t,'"].total-net'));i&&(i.textContent=this.formatCurrency(e.netAmount));var a=document.querySelector('th[data-cardquoteid="'.concat(t,'"] .total-gross-total'));a&&(a.textContent=this.formatCurrency(e.grossWithDiscount))},initializeCardCalculations:function(){var t=this;e(new Set(Array.from(document.querySelectorAll("[data-cardquoteid]")).map((function(t){return t.dataset.cardquoteid})))).forEach((function(e){t.calculateCardTotals(e)})),document.addEventListener("change",(function(e){var o,n=e.target,i=null===(o=n.closest("[data-cardquoteid]"))||void 0===o?void 0:o.dataset.cardquoteid;i&&(n.matches('input[name="markup"]')||n.matches('input[name="discount"]')||n.matches('select[name="tax[]"]')||n.matches(".item-price")||n.matches(".item-quantity")||n.matches(".item-optional"))&&t.calculateCardTotals(i)}))},formatDecimal:function(t){return new Intl.NumberFormat("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2}).format(t)},formatCurrency:function(t){return new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR"}).format(t)},parseNumber:function(t){return"number"==typeof t?t:parseFloat(t.replace(/[^\d,-]/g,"").replace(",","."))||0},handleInputBlur:function(t,e){if("keydown"===t.type){if("Enter"!==t.key)return;e=t.target.classList.contains("item-quantity")?"quantity":"price",t.target.blur()}var o=t.target.value,n=this.parseNumber(o);t.target.value="quantity"===e?this.formatDecimal(n):this.formatCurrency(n);var i=t.target.closest("tr"),a=i.dataset.id||i.dataset.itemid,r=i.dataset.groupid;"quantity"===e&&(this.items[a]&&(this.items[a].quantity=n),this.newItems[a]&&(this.newItems[a].quantity=n)),r&&this.calculateGroupTotal(r),this.calculateTotals()},handleOptionalChange:function(t,e){this.items[e]&&(this.items[e].optional=t.target.checked,this.newItems[e]&&(this.newItems[e].optional=t.target.checked),this.calculateTotals())},filterTable:function(){var e=this.searchQuery.toLowerCase();Object.entries(this.items).forEach((function(o){var n=t(o,2),i=n[0],a=n[1],r=document.querySelector('tr[data-itemid="'.concat(i,'"]'));r&&(r.style.display=a.name.toLowerCase().includes(e)||a.pos.toLowerCase().includes(e)?"":"none")})),Object.entries(this.groups).forEach((function(o){var n=t(o,2),i=n[0],a=n[1],r=document.querySelector('tr[data-groupid="'.concat(i,'"]'));r&&(r.style.display=a.name.toLowerCase().includes(e)||a.pos.toLowerCase().includes(e)?"":"none")})),document.querySelectorAll("tr.item_comment").forEach((function(t){var o=t.querySelector(".item-description"),n=t.querySelector(".pos-inner");if(o&&n){var i=o.value.toLowerCase(),a=n.textContent.toLowerCase();t.style.display=i.includes(e)||a.includes(e)?"":"none"}}))},initializeSortable:function(){var t=this;$("#estimation-edit-table").sortable({items:"tbody tr",cursor:"pointer",axis:"y",dropOnEmpty:!0,handle:".fa-bars, .fa-up-down",animation:150,start:function(t,e){e.item.addClass("selected")},stop:function(e,o){var n=o.item[0];if(n.classList.contains("item_row")||n.classList.contains("item_comment")){for(var i=n.previousElementSibling,a=null;i&&!a;)i.classList.contains("group_row")&&(a=i),i=i.previousElementSibling;if(a){var r=a.dataset.groupid,c=n.dataset.itemid||n.dataset.id;n.dataset.groupid;n.dataset.groupid=r,t.items[c]&&(t.items[c].groupId=r),t.newItems[c]&&(t.newItems[c].groupId=r)}}t.updatePOSNumbers(),t.calculateTotals()}})},initializeLastNumbers:function(){var e=this,o=new Set;document.querySelectorAll(".pos-inner").forEach((function(n){var i=n.textContent.trim();if(i){o.add(i);var a=t(i.split("."),2),r=a[0],c=a[1],u=parseInt(r),l=parseInt(c);e.lastGroupNumber=Math.max(e.lastGroupNumber,u),(!e.lastItemNumbers[u]||l>e.lastItemNumbers[u])&&(e.lastItemNumbers[u]=Math.min(l,99))}})),document.querySelectorAll(".grouppos").forEach((function(t){var o=parseInt(t.textContent.trim());e.lastGroupNumber=Math.max(e.lastGroupNumber,o)}))},addItem:function(t){var e,o=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=Date.now();if(!(document.querySelectorAll("tr.group_row").length>0)){var a=Date.now();e="group_".concat(a);var r={id:a,type:"group",name:"New Group",total:0,expanded:!1,pos:""};this.items[a]=r,this.newItems[a]=r,this.groups[e]={id:e,pos:"",name:"New Group",total:0,itemCount:0};var c=Date.now()+1,u={id:c,type:"item",groupId:e,name:"New Item",quantity:0,price:0,unit:"",optional:!1,expanded:!1,pos:""};return this.items[c]=u,this.newItems[c]=u,void this.$nextTick((function(){o.initializeSortable(),o.updatePOSNumbers(),o.calculateTotals()}))}if("group"===t){e="group_".concat(i);var l={id:i,type:"group",name:"Group name",total:0,expanded:!1,pos:""};return this.items[i]=l,this.newItems[i]=l,this.groups[e]={id:e,pos:"",name:"Group name",total:0,itemCount:0},void this.$nextTick((function(){o.initializeSortable(),o.updatePOSNumbers(),o.calculateTotals()}))}if(n){var s=document.querySelector('tr[data-id="'.concat(n,'"], \n                                               tr[data-itemid="').concat(n,'"], \n                                               tr[data-commentid="').concat(n,'"], \n                                               tr[data-groupid="').concat(n,'"]'));s&&(s.classList.contains("group_row"),e=s.dataset.groupid)}else{var d=document.querySelectorAll("tr.group_row"),m=d[d.length-1];e=m?m.dataset.groupid:null}var p={id:i,type:t,groupId:e,name:t+" name",quantity:0,price:0,unit:"",optional:!1,expanded:!1,pos:""};this.items[i]=p,this.newItems[i]=p,this.$nextTick((function(){if(n){var t=document.querySelector('tr[data-id="'.concat(n,'"], \n                                                   tr[data-itemid="').concat(n,'"], \n                                                   tr[data-commentid="').concat(n,'"], \n                                                   tr[data-groupid="').concat(n,'"]')),e=document.querySelector('tr[data-id="'.concat(i,'"], \n                                                tr[data-itemid="').concat(i,'"]'));e&&t.nextSibling&&t.parentNode.insertBefore(e,t.nextSibling)}o.initializeSortable(),o.updatePOSNumbers(),o.calculateTotals()})),n&&(this.contextMenu.show=!1)},removeItem:function(){var t=this,e=document.querySelectorAll(".item_selection:checked");0!==e.length?Swal.fire({title:"Confirmation Delete",text:"Really! You want to remove them? You can't undo",showCancelButton:!0,confirmButtonText:"Yes, Delete it",cancelButtonText:"No, cancel"}).then((function(o){if(o.isConfirmed){var n=[],i=[];e.forEach((function(e){var o=e.closest("tr");o.classList.contains("group_row")?(i.push(o.dataset.groupid),delete t.groups[o.dataset.groupid]):(n.push(o.dataset.itemid),delete t.items[o.dataset.itemid]),o.remove()})),document.querySelector(".SelectAllCheckbox").checked=!1,fetch(route("estimations.remove_items.estimate"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content},body:JSON.stringify({estimation_id:window.estimation_id,item_ids:n,group_ids:i})}),t.calculateTotals(),t.updatePOSNumbers()}})):toastrs("Error","Please select checkbox to continue delete")},updatePOSNumbers:function(){var t=this,e=0,o=0,n=null;document.querySelectorAll("tr").forEach((function(i){if(i.classList.contains("group_row")){e++,o=0,n=i.dataset.groupid;var a=e.toString().padStart(2,"0");i.querySelector(".grouppos").textContent="".concat(a),t.groups[n]&&(t.groups[n].pos=a)}else if(i.classList.contains("item_row")||i.classList.contains("item_comment")){o++;var r="".concat(e.toString().padStart(2,"0"),".").concat(o.toString().padStart(2,"0"));i.querySelector(".pos-inner").textContent=r;var c=i.dataset.itemid||i.dataset.commentid;t.items[c]&&(t.items[c].pos=r)}}))},toggleDescription:function(t,e){e.stopPropagation(),this.expandedRows||(this.expandedRows={}),this.expandedRows[t]=!this.expandedRows[t];var o=e.target.closest("tr"),n=document.querySelector('tr.item_child[data-id="'.concat(t,'"]'));if(n){n.style.display=this.expandedRows[t]?"table-row":"none";var i=o.querySelector(".desc_toggle");i&&(i.classList.toggle("fa-caret-right"),i.classList.toggle("fa-caret-down"))}},isExpanded:function(t){return this.expandedRows[t]||!1},initializeContextMenu:function(){var t=this;document.querySelector("#estimation-edit-table").addEventListener("contextmenu",(function(e){var o=e.target.closest("tr.item_row, tr.group_row, tr.item_comment");if(o){e.preventDefault();var n=window.innerWidth,i=window.innerHeight,a=e.clientX,r=e.clientY;a+160>n&&(a=n-160),r+160>i&&(r=i-160),t.contextMenu={show:!0,x:a,y:r,selectedRowId:o.dataset.id||o.dataset.itemid||o.dataset.commentid||o.dataset.groupid}}}))},moveRow:function(t,e){var o=document.querySelector('tr[data-id="'.concat(e,'"], \n                                         tr[data-itemid="').concat(e,'"], \n                                         tr[data-commentid="').concat(e,'"], \n                                         tr[data-groupid="').concat(e,'"]'));if(o){if("up"===t){var n=o.previousElementSibling;n&&o.parentNode.insertBefore(o,n)}else{var i=o.nextElementSibling;i&&o.parentNode.insertBefore(i,o)}this.updatePOSNumbers(),this.calculateTotals(),this.contextMenu.show=!1}},duplicateRow:function(t){var e=this,o=document.querySelector('tr[data-id="'.concat(t,'"], \n                                                 tr[data-itemid="').concat(t,'"], \n                                                 tr[data-commentid="').concat(t,'"], \n                                                 tr[data-groupid="').concat(t,'"]'));if(o){var n=Date.now(),i=o.classList.contains("group_row"),a=o.classList.contains("item_comment"),r=i?null:o.dataset.groupid;if(i){var c=o.querySelector(".grouptitle-input").value,u="group_".concat(n),l={id:n,type:"group",name:"".concat(c," - copy"),total:0,expanded:!1};this.items[n]=l,this.newItems[n]=l,this.groups[u]={id:u,pos:"",name:"".concat(c," - copy"),total:0,itemCount:0}}else if(a){var s={id:n,type:"comment",groupId:r,content:o.querySelector(".item-description").value,expanded:!1};this.items[n]=s,this.newItems[n]=s}else{var d,m,p,h,f,y={id:n,type:o.classList.contains("item_comment")?"comment":"item",groupId:r,name:(null===(d=o.querySelector(".item-name"))||void 0===d?void 0:d.value)+" - copy",quantity:this.parseNumber((null===(m=o.querySelector(".item-quantity"))||void 0===m?void 0:m.value)||"0"),unit:(null===(p=o.querySelector(".item-unit"))||void 0===p?void 0:p.value)||"",optional:(null===(h=o.querySelector(".item-optional"))||void 0===h?void 0:h.checked)||!1,price:this.parseNumber((null===(f=o.querySelector(".item-price"))||void 0===f?void 0:f.value)||"0"),expanded:!1};this.items[n]=y,this.newItems[n]=y,this.groups[r]&&this.groups[r].itemCount++}this.$nextTick((function(){var t=document.querySelector('tr[data-id="'.concat(n,'"], tr[data-itemid="').concat(n,'"], tr[data-commentid="').concat(n,'"]'));t&&o.nextSibling&&o.parentNode.insertBefore(t,o.nextSibling),e.updatePOSNumbers(),e.calculateTotals(),e.initializeContextMenu()})),this.contextMenu.show=!1}},removeRowFromMenu:function(t){var e=this;Swal.fire({title:"Confirmation Delete",text:"Really! You want to remove this item? You can't undo",showCancelButton:!0,confirmButtonText:"Yes, Delete it",cancelButtonText:"No, cancel"}).then((function(o){if(o.isConfirmed){var n=document.querySelector('tr[data-id="'.concat(t,'"], tr[data-itemid="').concat(t,'"], tr[data-groupid="').concat(t,'"]'));if(!n)return;if(n.classList.contains("group_row")){var i=n.dataset.groupid;document.querySelectorAll('tr[data-groupid="'.concat(i,'"]')).forEach((function(t){var o=t.dataset.itemid;delete e.items[o],delete e.newItems[o],t.remove()})),delete e.groups[i]}else{var a=n.dataset.itemid||n.dataset.id;delete e.items[a],delete e.newItems[a]}n.remove(),e.updatePOSNumbers(),e.calculateTotals(),document.querySelector(".SelectAllCheckbox").checked=!1}})),this.contextMenu.show=!1},handleGroupSelection:function(t,e){var o=t.target.checked,n=t.target.closest("tr.group_row");if(n)for(var i=n.nextElementSibling;i&&!i.classList.contains("group_row");){var a=i.querySelector(".item_selection");a&&(a.checked=o),i=i.nextElementSibling}},checkboxAll:function(t){document.querySelectorAll(".item_selection").forEach((function(e){e.checked=t}))},initializeColumnVisibility:function(){var t=this;document.querySelectorAll(".column-toggle").forEach((function(e){e.addEventListener("change",(function(e){var o=e.target.dataset.column,n=e.target.dataset.quoteid;"quote_th"===o&&n?(t.columnVisibility[o]=e.target.checked,t.applyColumnVisibility(n)):(t.columnVisibility[o]=e.target.checked,t.applyColumnVisibility()),t.saveColumnVisibility()}))}))},applyColumnVisibility:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;Object.entries(this.columnVisibility).forEach((function(o){var n=t(o,2),i=n[0],a=n[1];if("quote_th"===i&&e){var r=document.querySelectorAll(".quote_th".concat(e,", ")+'[data-cardquoteid="'.concat(e,'"]'));console.log(r),r.forEach((function(t){t.style.display=a?"":"none"}))}else{document.querySelectorAll(".".concat(i)).forEach((function(t){t.closest("td, th")&&(t.closest("td, th").style.display=a?"":"none")}))}}))},saveColumnVisibility:function(){localStorage.setItem("columnVisibility",JSON.stringify(this.columnVisibility))},toggleColumn:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.columnVisibility[t]=!this.columnVisibility[t],this.applyColumnVisibility(e),this.saveColumnVisibility();var o=e?'.column-toggle[data-column="'.concat(t,'"][data-quote="').concat(e,'"]'):'.column-toggle[data-column="'.concat(t,'"]'),n=document.querySelector(o);n&&(n.checked=this.columnVisibility[t])}}}))}}]);